{% extends 'Market/base.html' %}

{% block title %}Головна - Ресторан "Смакота"{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section text-center py-5">
    <div class="container">
        <h1 class="display-3 mb-4">
            <i class="fas fa-utensils"></i> Ресторан "Смакота"
        </h1>
        <a href="/market/menu" class="btn btn-warning btn-lg">
            <i class="fas fa-utensils"></i> Подивитись меню
        </a>
    </div>
</section>

<!-- Basic Contact Info -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-map-marker-alt fa-2x text-warning mb-3"></i>
                    <h5>Адреса</h5>
                    <p>вул. Хрещатик, 1<br>Київ, Україна</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-phone fa-2x text-warning mb-3"></i>
                    <h5>Телефон</h5>
                    <p>+380 44 123 45 67</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-clock fa-2x text-warning mb-3"></i>
                    <h5>Режим роботи</h5>
                    <p>Пн-Нд: 10:00 - 23:00</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 3D Model Section -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="mb-4">
                    <i class="fas fa-cube"></i> Інтерактивна 3D модель
                </h2>
                <div id="model3d-container" style="width: 100%; height: 400px; border: 2px solid #ffc107; border-radius: 10px; cursor: pointer;">
                    <canvas id="model3d-canvas"></canvas>
                </div>
                <p class="mt-3 text-muted">
                    <i class="fas fa-mouse-pointer"></i> Натисніть для переходу на іншу сторінку 
                    <span class="mx-2">|</span>
                    <i class="fas fa-hand-rock"></i> Утримуйте та перетягуйте для обертання
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Three.js Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
// 3D Model Setup
let scene, camera, renderer, model, controls;
let isMouseDown = false;
let autoRotate = true;

function init3DModel() {
    const container = document.getElementById('model3d-container');
    const canvas = document.getElementById('model3d-canvas');
    
    // Scene setup
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0); // Lighter background
    
    // Camera setup
    camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
    camera.position.set(0, 0, 6);
    
    // Renderer setup
    renderer = new THREE.WebGLRenderer({ 
        canvas: canvas, 
        antialias: true,
        alpha: true
    });
    renderer.setSize(container.offsetWidth, container.offsetHeight);
    renderer.physicallyCorrectLights = true;
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 2.5;
    renderer.shadowMap.enabled = false; // Disable shadows for brighter appearance
    
    // Lighting - Maximum brightness setup
    const ambientLight = new THREE.AmbientLight(0xffffff, 8);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 5);
    directionalLight.position.set(5, 5, 5);
    scene.add(directionalLight);
    
    // Additional lighting for maximum brightness from all directions
    const directionalLight2 = new THREE.DirectionalLight(0xffffff, 4);
    directionalLight2.position.set(-5, 5, -5);
    scene.add(directionalLight2);
    
    const directionalLight3 = new THREE.DirectionalLight(0xffffff, 3);
    directionalLight3.position.set(0, -5, 5);
    scene.add(directionalLight3);
    
    const directionalLight4 = new THREE.DirectionalLight(0xffffff, 3);
    directionalLight4.position.set(0, 5, -5);
    scene.add(directionalLight4);
    
    const directionalLight5 = new THREE.DirectionalLight(0xffffff, 2);
    directionalLight5.position.set(5, 0, 0);
    scene.add(directionalLight5);
    
    const directionalLight6 = new THREE.DirectionalLight(0xffffff, 2);
    directionalLight6.position.set(-5, 0, 0);
    scene.add(directionalLight6);
    
    // Controls setup
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.1;
    controls.enabled = false; // Initially disabled for auto-rotation
    
    // Load 3D model
    const loader = new THREE.GLTFLoader();
    loader.load('{% load static %}{% static "market/models/Black_car_coin.glb" %}', function(gltf) {
        model = gltf.scene;
        
        // Scale and position the model
        model.scale.set(2, 2, 2);
        model.position.set(0, -0.3, 0);
        
        // Simple material setup - let model use its original materials
        model.traverse(function(node) {
            if (node.isMesh) {
                node.castShadow = true;
                node.receiveShadow = true;
                
                // Minimal material adjustments
                if (node.material) {
                    // Just ensure materials work with lighting
                    node.material.needsUpdate = true;
                }
            }
        });
        
        scene.add(model);
        console.log('3D model loaded successfully:', model);
    }, 
    function(progress) {
        console.log('Loading progress:', (progress.loaded / progress.total * 100) + '%');
    },
    function(error) {
        console.error('Error loading 3D model:', error);
    });
    
    // Mouse events
    canvas.addEventListener('mousedown', onMouseDown);
    canvas.addEventListener('mouseup', onMouseUp);
    canvas.addEventListener('mouseleave', onMouseUp);
    
    // Click event for navigation
    canvas.addEventListener('click', function(event) {
        if (!isMouseDown) {
            // Navigate to another page (you can change this URL)
            window.location.href = '#'; // Replace with actual URL
        }
    });
    
    // Resize handler
    window.addEventListener('resize', onWindowResize);
    
    // Start animation loop
    animate();
}

function onMouseDown(event) {
    isMouseDown = true;
    autoRotate = false;
    controls.enabled = true;
}

function onMouseUp(event) {
    setTimeout(() => {
        isMouseDown = false;
        autoRotate = true;
        controls.enabled = false;
    }, 100);
}

function onWindowResize() {
    const container = document.getElementById('model3d-container');
    camera.aspect = container.offsetWidth / container.offsetHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.offsetWidth, container.offsetHeight);
}

function animate() {
    requestAnimationFrame(animate);
    
    // Auto rotation when not being dragged
    if (autoRotate && model) {
        model.rotation.y += 0.01;
    }
    
    controls.update();
    renderer.render(scene, camera);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    init3DModel();
});
</script>

{% endblock %}