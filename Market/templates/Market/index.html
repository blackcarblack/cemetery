{% extends 'Market/base.html' %}

{% block title %}Головна - Ресторан "Смакота"{% endblock %}

{% block content %}
<section class="hero-section py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8 text-center text-md-start">
                <h1 class="display-3 mb-4">
                    <i class="fas fa-utensils"></i> Ресторан "Смакота"
                </h1>
                <a href="/market/menu" class="btn btn-warning btn-lg">
                    <i class="fas fa-utensils"></i> Подивитись меню
                </a>
            </div>
            <div class="col-md-4 text-center">
                <div class="bonus-button-container" style="display: inline-block; position: relative;">
                    <div id="bonus-model3d-container" style="width: 200px; height: 150px; cursor: pointer; transition: transform 0.3s ease;">
                        <canvas id="bonus-model3d-canvas"></canvas>
                    </div>
                    {% if user.is_authenticated %}
                        <div class="mt-2" style="background-color: #ffc107; color: #000; padding: 8px 16px; border-radius: 20px; display: inline-block; font-weight: bold; font-size: 18px;">
                            <i class="fas fa-coins"></i> {{ user.bonus_points }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Basic Contact Info -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-map-marker-alt fa-2x text-warning mb-3"></i>
                    <h5>Адреса</h5>
                    <p>вул. Хрещатик, 1<br>Київ, Україна</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-phone fa-2x text-warning mb-3"></i>
                    <h5>Телефон</h5>
                    <p>+380 44 123 45 67</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-clock fa-2x text-warning mb-3"></i>
                    <h5>Режим роботи</h5>
                    <p>Пн-Нд: 10:00 - 23:00</p>
                </div>
            </div>
        </div>
    </div>
</section>





<!-- Three.js Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
// Bonus Button 3D Model Setup
let bonusScene, bonusCamera, bonusRenderer, bonusModel;
let bonusAutoRotate = true;

function initBonusButton3D() {
    const bonusContainer = document.getElementById('bonus-model3d-container');
    const bonusCanvas = document.getElementById('bonus-model3d-canvas');
    
    if (!bonusContainer || !bonusCanvas) return;
    
    // Scene setup
    bonusScene = new THREE.Scene();
    bonusScene.background = null; // Прозорий фон для зливання з сайтом
    
    // Camera setup
    bonusCamera = new THREE.PerspectiveCamera(75, bonusContainer.offsetWidth / bonusContainer.offsetHeight, 0.1, 1000);
    bonusCamera.position.set(0, 0, 4);
    
    // Renderer setup
    bonusRenderer = new THREE.WebGLRenderer({ 
        canvas: bonusCanvas, 
        antialias: true,
        alpha: true
    });
    bonusRenderer.setSize(bonusContainer.offsetWidth, bonusContainer.offsetHeight);
    bonusRenderer.physicallyCorrectLights = true;
    bonusRenderer.outputEncoding = THREE.sRGBEncoding;
    bonusRenderer.toneMapping = THREE.ACESFilmicToneMapping;
    bonusRenderer.toneMappingExposure = 2.5;
    
    // Додаємо OrbitControls для інтерактивності
    window.bonusControls = new THREE.OrbitControls(bonusCamera, bonusCanvas);
    window.bonusControls.enableDamping = true;
    window.bonusControls.dampingFactor = 0.05;
    window.bonusControls.screenSpacePanning = false;
    window.bonusControls.minDistance = 2;
    window.bonusControls.maxDistance = 8;
    window.bonusControls.enablePan = false; // Вимкнути переміщення
    window.bonusControls.enableZoom = false; // Вимкнути zoom
    
    // Обмежити обертання тільки по горизонталі (тільки azimuth, не polar)
    window.bonusControls.minPolarAngle = Math.PI / 2; // 90 градусів
    window.bonusControls.maxPolarAngle = Math.PI / 2; // 90 градусів
    // Це зафіксує вертикальний кут і дозволить тільки горизонтальне обертання
    
    // Lighting setup - Maximum brightness
    const bonusAmbientLight = new THREE.AmbientLight(0xffffff, 10);
    bonusScene.add(bonusAmbientLight);
    
    const bonusDirectionalLight = new THREE.DirectionalLight(0xffffff, 8);
    bonusDirectionalLight.position.set(3, 3, 3);
    bonusScene.add(bonusDirectionalLight);
    
    const bonusDirectionalLight2 = new THREE.DirectionalLight(0xffffff, 6);
    bonusDirectionalLight2.position.set(-3, 3, -3);
    bonusScene.add(bonusDirectionalLight2);
    
    // Additional lighting for maximum brightness
    const bonusDirectionalLight3 = new THREE.DirectionalLight(0xffffff, 5);
    bonusDirectionalLight3.position.set(0, -3, 3);
    bonusScene.add(bonusDirectionalLight3);
    
    const bonusDirectionalLight4 = new THREE.DirectionalLight(0xffffff, 4);
    bonusDirectionalLight4.position.set(0, 3, -3);
    bonusScene.add(bonusDirectionalLight4);
    
    // Load 3D model for bonus button
    const bonusLoader = new THREE.GLTFLoader();
    bonusLoader.load('{% load static %}{% static "market/models/Black_car_coin.glb" %}', function(gltf) {
        bonusModel = gltf.scene;
        
        // Scale and position the model (smaller for button)
        bonusModel.scale.set(1.5, 1.5, 1.5);
        bonusModel.position.set(0, -0.2, 0);
        
        // Робимо модель горизонтальною
        bonusModel.rotation.x = 0; // Горизонтальне положення
        
        bonusModel.traverse(function(node) {
            if (node.isMesh) {
                node.castShadow = true;
                node.receiveShadow = true;
                
                if (node.material) {
                    node.material.needsUpdate = true;
                }
            }
        });
        
        bonusScene.add(bonusModel);
    });
    
    // Click event for navigation to bonus shop
    bonusContainer.addEventListener('click', function() {
        // Navigate to bonus shop
        window.location.href = '/market/menu/';
    });
    
    // Hover effects
    bonusContainer.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05)';
        this.style.boxShadow = '0 4px 15px rgba(255, 193, 7, 0.4)';
    });
    
    bonusContainer.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
        this.style.boxShadow = 'none';
    });
    
    // Start animation loop for bonus button
    animateBonusButton();
}

function animateBonusButton() {
    requestAnimationFrame(animateBonusButton);
    
    // Оновлюємо controls для плавності інтерактивності
    if (window.bonusControls) {
        window.bonusControls.update();
    }
    
    // Auto rotation for bonus button - постійне обертання монети
    if (bonusAutoRotate && bonusModel) {
        bonusModel.rotation.y -= 0.01; // Плавне обертання монети в іншу сторону
    }
    
    if (bonusRenderer && bonusScene && bonusCamera) {
        bonusRenderer.render(bonusScene, bonusCamera);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    initBonusButton3D();
});
</script>

{% endblock %}